$((function(){$.fn.imagesLoaded=function(callback){var $images=this.find("img"),len=$images.length,_this=this,blank="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";function triggerCallback(){callback.call(_this,$images)}function imgLoaded(){--len<=0&&this.src!==blank&&(setTimeout(triggerCallback),$images.off("load error",imgLoaded))}return len||triggerCallback(),$images.on("load error",imgLoaded).each((function(){if(this.complete||void 0===this.complete){var src=this.src;this.src=blank,this.src=src}})),this};var $rgGallery=$("#rg-gallery"),$esCarousel=$rgGallery.find("div.es-carousel-wrapper"),$items=$esCarousel.find("ul > li"),itemsCount=$items.length,current,mode,anim,init,_initCarousel,_addViewModes,_addImageWrapper,_navigate,_showImage,addItems;Gallery=(current=0,mode="carousel",anim=!1,init=function(){$items.add('<img src="img/images/ajax-loader.gif"/><img src="img/images/black.png"/>').imagesLoaded((function(){_addViewModes(),_addImageWrapper(),_showImage($items.eq(current))})),"carousel"===mode&&_initCarousel()},_initCarousel=function(){$esCarousel.show().elastislide({imageW:65,onClick:function($item){if(anim)return!1;anim=!0,_showImage($item),current=$item.index()}}),$esCarousel.elastislide("setCurrent",current)},_addViewModes=function(){var $viewfull=$('<a href="#" class="rg-view-full"></a>'),$viewthumbs=$('<a href="#" class="rg-view-thumbs rg-view-selected"></a>');$rgGallery.prepend($('<div class="rg-view"/>').append($viewfull).append($viewthumbs)),$viewfull.on("click.rgGallery",(function(event){return"carousel"===mode&&$esCarousel.elastislide("destroy"),$esCarousel.hide(),$viewfull.addClass("rg-view-selected"),$viewthumbs.removeClass("rg-view-selected"),mode="fullview",!1})),$viewthumbs.on("click.rgGallery",(function(event){return _initCarousel(),$viewthumbs.addClass("rg-view-selected"),$viewfull.removeClass("rg-view-selected"),mode="carousel",!1})),"fullview"===mode&&$viewfull.trigger("click")},_addImageWrapper=function(){if($("#img-wrapper-tmpl").tmpl({itemsCount:itemsCount}).appendTo($rgGallery),itemsCount>1){var $navPrev=$rgGallery.find("a.rg-image-nav-prev"),$navNext=$rgGallery.find("a.rg-image-nav-next"),$imgWrapper=$rgGallery.find("div.rg-image");$navPrev.on("click.rgGallery",(function(event){return _navigate("left"),!1})),$navNext.on("click.rgGallery",(function(event){return _navigate("right"),!1})),$imgWrapper.touchwipe({wipeLeft:function(){_navigate("right")},wipeRight:function(){_navigate("left")},preventDefaultEvents:!1}),$(document).on("keyup.rgGallery",(function(event){39==event.keyCode?_navigate("right"):37==event.keyCode&&_navigate("left")}))}},_navigate=function(dir){if(anim)return!1;anim=!0,"right"===dir?current+1>=itemsCount?current=0:++current:"left"===dir&&(current-1<0?current=itemsCount-1:--current),_showImage($items.eq(current))},_showImage=function($item){var $loader=$rgGallery.find("div.rg-loading").show();$items.removeClass("selected"),$item.addClass("selected");var $thumb=$item.find("img"),largesrc=$thumb.data("large"),title=$thumb.data("description");$("<img/>").load((function(){$rgGallery.find("div.rg-image").empty().append('<img src="'+largesrc+'"/>'),title&&$rgGallery.find("div.rg-caption").show().children("p").empty().text(title),$loader.hide(),"carousel"===mode&&($esCarousel.elastislide("reload"),$esCarousel.elastislide("setCurrent",current)),anim=!1})).attr("src",largesrc)},{init:init,addItems:function($new){$esCarousel.find("ul").append($new),$items=$items.add($($new)),itemsCount=$items.length,$esCarousel.elastislide("add",$new)}}),Gallery.init()}));